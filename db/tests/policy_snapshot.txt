-- Policy snapshot: RLS policies for public schema
-- Formatering h√•ndteres av psql-flagg: -A (unaligned), -t (tuples-only)
select
  schemaname       as schema,
  tablename        as table,
  policyname,
  cmd,
  coalesce(qual::text,'')       as qual,
  coalesce(with_check::text,'') as with_check
from pg_policies
where schemaname = 'public'
order by schemaname, tablename, policyname, cmd;
 schema |        table         |            policyname            |  cmd   |                                                                                                                                                                                                                                                   qual                                                                                                                                                                                                                                                    |                                                                                                                                                                                                                                                                with_check                                                                                                                                                                                                                                                                
--------+----------------------+----------------------------------+--------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 public | ai_runs              | ai_runs_insert_admin_mfa         | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | ai_runs              | ai_runs_select_org_admin         | SELECT | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                       | 
 public | ai_runs              | ai_runs_update_admin_mfa         | UPDATE | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                  | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | ai_suggestions       | ai_suggestions_insert_admin_mfa  | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | ai_suggestions       | ai_suggestions_select_org_admin  | SELECT | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                       | 
 public | ai_suggestions       | ai_suggestions_update_admin_mfa  | UPDATE | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                  | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | audit_events         | ae_select_org_admin              | SELECT | (((actor_org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                 | 
 public | audit_events         | ae_select_self                   | SELECT | (actor_user_id = (NULLIF(current_setting('request.user_id'::text, true), ''::text))::uuid)                                                                                                                                                                                                                                                                                                                                                                                                                | 
 public | content_templates    | content_templates_crud_admin_mfa | ALL    | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                  | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | content_templates    | content_templates_select_org     | SELECT | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                         | 
 public | csv_import_sessions  | csv_sessions_crud_admin_mfa      | ALL    | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                  | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | csv_import_sessions  | csv_sessions_select_org          | SELECT | (((org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                         | 
 public | invitations          | inv_insert_admin_mfa             | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | invitations          | inv_select_org_admin             | SELECT | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (email = NULLIF(current_setting('request.clerk_user_email'::text, true), ''::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                       | 
 public | invitations          | inv_update_admin_mfa_revoke      | UPDATE | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                         | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text) AND (status = ANY (ARRAY['pending'::invitation_status, 'revoked'::invitation_status]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | invitations          | inv_update_invitee_accept        | UPDATE | (email = NULLIF(current_setting('request.clerk_user_email'::text, true), ''::text))                                                                                                                                                                                                                                                                                                                                                                                                                       | ((email = NULLIF(current_setting('request.clerk_user_email'::text, true), ''::text)) AND (status = ANY (ARRAY['pending'::invitation_status, 'accepted'::invitation_status])))
 public | kb_docs              | kb_docs_delete_scope_guard       | DELETE | (((scope = 'ORG'::kb_scope) AND (org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR ((scope = 'GLOBAL'::kb_scope) AND (current_setting('request.platform_role'::text, true) = 'super_admin'::text))) | 
 public | kb_docs              | kb_docs_insert_org_admin         | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | (((scope = 'ORG'::kb_scope) AND (org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR ((scope = 'GLOBAL'::kb_scope) AND (current_setting('request.platform_role'::text, true) = 'super_admin'::text)))
 public | kb_docs              | kb_docs_select_global            | SELECT | ((scope = 'GLOBAL'::kb_scope) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text) OR ((scope = 'ORG'::kb_scope) AND (org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text)))                                                                                                                                                                                           | 
 public | kb_docs              | kb_docs_update_scope_guard       | UPDATE | (((scope = 'ORG'::kb_scope) AND (org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR ((scope = 'GLOBAL'::kb_scope) AND (current_setting('request.platform_role'::text, true) = 'super_admin'::text))) | (((scope = 'ORG'::kb_scope) AND (org_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR ((scope = 'GLOBAL'::kb_scope) AND (current_setting('request.platform_role'::text, true) = 'super_admin'::text)))
 public | memberships          | ms_select_org_admin              | SELECT | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                              | 
 public | memberships          | ms_select_self                   | SELECT | ((user_id = (NULLIF(current_setting('request.user_id'::text, true), ''::text))::uuid) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                                                                                                    | 
 public | memberships          | ms_update_admin_mfa              | UPDATE | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                         | (((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | organization_domains | org_domains_delete_admin_mfa     | DELETE | ((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text))                                                                                                                                           | 
 public | organization_domains | org_domains_insert_admin_mfa     | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | ((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text))
 public | organization_domains | org_domains_select_approved      | SELECT | ((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text))                                                                                                                                                                                                                                                                                                                                  | 
 public | organization_domains | org_domains_update_admin_mfa     | UPDATE | ((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text))                                                                                                                                           | ((organization_id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text))
 public | organizations        | orgs_select_approved_context     | SELECT | (((id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                             | 
 public | organizations        | orgs_update_admin_mfa            | UPDATE | (((id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text]))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                           | (((id = (NULLIF(current_setting('request.org_id'::text, true), ''::text))::uuid) AND (current_setting('request.org_status'::text, true) = 'approved'::text) AND (current_setting('request.org_role'::text, true) = ANY (ARRAY['admin'::text, 'owner'::text])) AND (COALESCE(current_setting('request.mfa'::text, true), 'off'::text) = 'on'::text) AND (NOT (orgnr IS DISTINCT FROM ( SELECT o2.orgnr                                                                                                                                   +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id)))) AND (NOT (name IS DISTINCT FROM ( SELECT o2.name                                                                                                                                                                                                                                                                                                                                                                                                                                                  +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id)))) AND (NOT (org_form IS DISTINCT FROM ( SELECT o2.org_form                                                                                                                                                                                                                                                                                                                                                                                                                                          +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id)))) AND (NOT (registered_at IS DISTINCT FROM ( SELECT o2.registered_at                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id)))) AND (NOT (status_text IS DISTINCT FROM ( SELECT o2.status_text                                                                                                                                                                                                                                                                                                                                                                                                                                    +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id)))) AND (NOT (raw_brreg_json IS DISTINCT FROM ( SELECT o2.raw_brreg_json                                                                                                                                                                                                                                                                                                                                                                                                                              +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM organizations o2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (o2.id = organizations.id))))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
 public | platform_admins      | platform_admins_super            | ALL    | (current_setting('request.platform_role'::text, true) = 'super_admin'::text)                                                                                                                                                                                                                                                                                                                                                                                                                              | (current_setting('request.platform_role'::text, true) = 'super_admin'::text)
 public | user_org_selection   | user_owns_row                    | ALL    | (user_id = (NULLIF(current_setting('request.user_id'::text, true), ''::text))::uuid)                                                                                                                                                                                                                                                                                                                                                                                                                      | 
 public | user_org_selection   | user_owns_row_write_insert       | INSERT |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | (user_id = (NULLIF(current_setting('request.user_id'::text, true), ''::text))::uuid)
 public | user_org_selection   | user_owns_row_write_update       | UPDATE | (user_id = (NULLIF(current_setting('request.user_id'::text, true), ''::text))::uuid)                                                                                                                                                                                                                                                                                                                                                                                                                      | 
 public | users                | users_select_self                | SELECT | ((clerk_user_id = current_setting('request.clerk_user_id'::text, true)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                                                                                                                  | 
 public | users                | users_update_self_safe           | UPDATE | ((clerk_user_id = current_setting('request.clerk_user_id'::text, true)) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))                                                                                                                                                                                                                                                                                                                                                  | (((clerk_user_id = current_setting('request.clerk_user_id'::text, true)) AND (NOT (mfa_level IS DISTINCT FROM ( SELECT u2.mfa_level                                                                                                                                                                                                                                                                                                                                                                                                     +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    FROM users u2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        +
        |                      |                                  |        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |   WHERE (u2.id = users.id))))) OR (current_setting('request.platform_role'::text, true) = 'super_admin'::text))
(35 rows)

